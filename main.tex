\documentclass[11pt,a4paper]{article}

% --- Езици и кодировки ---
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[bulgarian]{babel}

% --- Стил и оформление ---
\usepackage{geometry}
\geometry{margin=2.54cm} % стандартни полета 1 inch

\usepackage{parskip} % разстояние между абзаци, без отстъп
\setlength{\parindent}{0pt} % нулев отстъп

%\usepackage{microtype} % по-добра типография
\usepackage{hyperref}  % за линкове
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    urlcolor=blue,
    pdftitle={Биткойн: Директна електронна парична система},
    pdfauthor={Сатоши Накамото}
}

% --- Страници ---
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}

\usepackage{tikz}
\usetikzlibrary{arrows.meta, positioning}

% --- Заглавие ---
\title{\textbf{Биткойн: Директна електронна парична система}}
\author{Сатоши Накамото}
\date{}

\begin{document}

\maketitle

\begin{abstract}
Една чиста версия на електронни пари, работеща на принципа на равноправни участници (peer-to-peer), би позволила онлайн плащанията да се изпращат направо от един човек на друг, без да е необходимо да минават през финансова институция. Електронните подписи предлагат частично решение, но основните предимства изчезват, ако все пак се нуждаем от доверена трета страна, която да предотвратява двойното харчене. Ние предлагаме решение на проблема с двойното харчене, използвайки мрежа с пряка връзка. Мрежата датира всяка транзакция, като я записва в непрекъсната верига от криптографски\footnote{Криптографията e наука за методите за запазване на информацията в тайна и за удостоверяване на нейната автентичност.} хешове\footnote{Хеш е еднопосочна функция, която преобразува входни данни с произволна дължина в изходен низ с фиксирана дължина (хеш стойност), често използван за проверка на целостта на данни или за сигурност.}, базирани на доказателство за извършена работа (proof-of-work). Така се създава невъзможен за промяна запис, освен ако не се извърши отново цялата работа по доказването. Най-дългата верига служи не само като доказателство за последователността на събитията, на които сме свидетели, но и като доказателство, че произлиза от най-големия обем изчислителна мощност. Докато по-голямата част от тази мощност се контролира от възли, които не си сътрудничат с цел атака на мрежата, те ще генерират най-дългата верига и ще надделеят над нападателите. Самата мрежа изисква минимална организация. Съобщенията се разпространяват според възможностите, а възлите могат да напускат и да се присъединяват отново към мрежата по всяко време, приемайки най-дългата верига от доказателства за работа като доказателство за събитията, случили се докато са отсъствали.
\end{abstract}

\section{Въведение}

Търговията в интернет разчита почти изключително на финансови институции, служещи като доверени трети страни за обработка на електронни плащания. Въпреки че системата работи достатъчно добре за повечето транзакции, тя все още страда от присъщите слабости на модела, основан на доверие. Напълно необратимите транзакции не са реално възможни, тъй като финансовите институции не могат да избегнат медиацията при спорове. Цената на медиацията увеличава транзакционните разходи, ограничавайки минималния практически размер на транзакцията и отрязвайки възможността за малки, случайни транзакции, и има по-широка цена от загубата на възможност за извършване на необратими плащания за необратими услуги. С възможността за отмяна, необходимостта от доверие се разпространява. Търговците трябва да бъдат предпазливи към клиентите си, като ги тормозят за повече информация, отколкото иначе биха им били необходими. Известен процент измами се приемат за неизбежни. Тези разходи и несигурност при плащането могат да бъдат избегнати лично чрез използване на физическа валута, но не съществува механизъм за извършване на плащания по комуникационен канал без доверена страна.

Необходима е електронна платежна система, базирана на криптографско доказателство, вместо на доверие, позволяваща на две желаещи страни да извършват директни транзакции помежду си, без да е необходима доверена трета страна. Транзакции, чието отмяна е изчислително непрактично, биха защитили продавачите от измами, а рутинни механизми за ескроу биха могли лесно да бъдат внедрени за защита на купувачите. В тази статия предлагаме решение на проблема с двойното харчене, използвайки разпределен peer-to-peer сървър за времеви марки, за да генерира изчислително доказателство за хронологичния ред на транзакциите. Системата е сигурна, стига честните възли колективно да контролират повече процесорна мощност от която и да е сътрудничеща си група от атакуващи възли.

\section{Транзакции}

Дефинираме електронна монета като верига от цифрови подписи. Всеки собственик прехвърля монетата на следващия, като подписва цифрово хеш на предишната транзакция и публичния ключ на следващия собственик и ги добавя в края на монетата. Получателят може да провери подписите, за да потвърди веригата на собственост.

\begin{tikzpicture}[
	scale=0.6, % Още по-малък мащаб
	node distance=0.6cm and 1cm, % Още по-малки разстояния
	block/.style={rectangle, draw, thick, text centered, rounded corners, font=\scriptsize, inner sep=2pt}, % Още по-малък шрифт и вътрешно отстояние
	line/.style={draw, -Latex, thick},
	dashed_line/.style={draw, dashed, -Latex, thick},
	every node/.style={align=center} % Центриране на текста в многоредови възли
	]
	% Първа транзакция
	\node (trans1) [block] {Транзакция};
	\node (pk1) [block, below=of trans1] {Публичен Ключ на Притежател 1};
	\node (hash1) [block, below=of pk1] {Хеш};
	\node (sig0) [block, below=of hash1] {Подпис на Притежател 0};
	\node (privk1) [block, below left=0.8cm and 0.3cm of sig0] {Частен Ключ на Притежател 1};
	
	\draw [->] (trans1) -- (pk1);
	\draw [->] (pk1) -- (hash1);
	\draw [->] (hash1) -- (sig0);
	\draw [dashed, ->] (privk1) -- node[left, font=\tiny] {Подпис} (trans1);
	\draw [dashed, ->] (pk1) -- node[above left, font=\tiny] {Проверка} (sig0);
	
	% Втора транзакция
	\node (trans2) [block, right=1.5cm of trans1] {Транзакция};
	\node (pk2) [block, below=of trans2] {Публичен Ключ на Притежател 2};
	\node (hash2) [block, below=of pk2] {Хеш};
	\node (sig1) [block, below=of hash2] {Подпис на Притежател 1};
	\node (privk2) [block, below left=0.8cm and 0.3cm of sig1] {Частен Ключ на Притежател 2};
	
	\draw [->] (trans2) -- (pk2);
	\draw [->] (pk2) -- (hash2);
	\draw [->] (hash2) -- (sig1);
	\draw [dashed, ->] (privk2) -- node[left, font=\tiny] {Подпис} (trans2);
	\draw [dashed, ->] (pk2) -- node[above left, font=\tiny] {Проверка} (sig1);
	\draw [dashed, ->] (pk1.south east) -- ++(0.2cm,-0.2cm) -- (sig1.north west);
	
	% Трета транзакция
	\node (trans3) [block, right=1.5cm of trans2] {Транзакция};
	\node (pk3) [block, below=of trans3] {Публичен Ключ на Притежател 3};
	\node (hash3) [block, below=of pk3] {Хеш};
	\node (sig2) [block, below=of hash3] {Подпис на Притежател 2};
	\node (privk3) [block, below left=0.8cm and 0.3cm of sig2] {Частен Ключ на Притежател 3};
	
	\draw [->] (trans3) -- (pk3);
	\draw [->] (pk3) -- (hash3);
	\draw [->] (hash3) -- (sig2);
	\draw [dashed, ->] (privk3) -- node[left, font=\tiny] {Подпис} (trans3);
	\draw [dashed, ->] (pk3) -- node[above left, font=\tiny] {Проверка} (sig2);
	\draw [dashed, ->] (pk2.south east) -- ++(0.2cm,-0.2cm) -- (sig2.north west);
	
\end{tikzpicture}

Проблемът, разбира се, е, че получателят не може да провери дали някой от собствениците не е похарчил монетата двойно. Често срещано решение е въвеждането на доверен централен орган или монетен двор, който проверява всяка транзакция за двойно харчене. След всяка транзакция монетата трябва да бъде върната в монетния двор, за да се емитира нова монета, и само монетите, емитирани директно от монетния двор, са надеждни, че няма да бъдат похарчени двойно. Проблемът с това решение е, че съдбата на цялата парична система зависи от компанията, която управлява монетния двор, като всяка транзакция трябва да премине през тях, точно както банка.

Нуждаем се от начин получателят да знае, че предишните собственици не са подписвали никакви по-ранни транзакции. За нашите цели най-ранната транзакция е тази, която се брои, така че не ни интересуват по-късни опити за двойно харчене. Единственият начин да се потвърди липсата на транзакция е да се знае за всички транзакции. В модела, базиран на монетния двор, монетният двор е бил наясно с всички транзакции и е решавал коя е пристигнала първа. За да се постигне това без доверено лице, транзакциите трябва да бъдат публично обявени [1] и се нуждаем от система, в която участниците да се споразумеят за единна история на реда, в който са били получени. Получателят се нуждае от доказателство, че по време на всяка транзакция, по-голямата част от възлите са се съгласили, че това е първата получена транзакция.

\section{Сървър за времеви печати}
Предлаганото от нас решение започва със сървър за времеви печати. Сървърът за времеви печати работи, като взема хеш на блок от елементи, които трябва да бъдат маркирани с времеви печат, и публикува хеша широко, например във вестник или публикация в Usenet [2-5]. Времевият печат доказва, че данните е трябвало да са съществували по това време, очевидно, за да попаднат в хеша. Всеки времеви печат включва предишния времеви печат в своя хеш, образувайки верига, като всеки допълнителен времеви печат подсилва тези преди него.

Диаграма

\section{Доказателство за извършена работа (Proof-of-Work)}

За да имплементираме разпределен сървър за времеви марки на peer-to-peer база, ще трябва да използваме система за доказателство за работа, подобна на Hashcash [6] на Адам Бек, вместо публикации във вестници или Usenet. Доказателството за работа включва сканиране за стойност, която при хеширане, например с SHA-256, хешът започва с определен брой нули битове. Средната необходима работа е експоненциална в броя на необходимите нули битове и може да бъде проверена чрез изпълнение на едно хеширане.

За нашата мрежа с времеви марки, ние имплементираме доказателството за работа чрез увеличаване на nonce в блока, докато не се намери стойност, която дава на хеша на блока необходимите нули битове. След като процесорните усилия са изразходвани, за да се удовлетвори доказателството за работа, блокът не може да бъде променен без да се извърши повторно действието. Тъй като по-късни блокове се свързват след него, работата по промяната на блока ще включва повторно изпълнение на всички блокове след него.

Диаграма

Доказателството за работа също решава проблема с определянето на представителството при вземането на решения с мнозинство. Ако мнозинството се основаваше на един IP адрес - един глас, то би могло да бъде подкопано от всеки, който е способен да разпредели много IP адреси. Доказателството за работа е по същество един процесор - един глас. Решението на мнозинството е представено от най-дългата верига, в която са инвестирани най-големи усилия за доказателство за работа. Ако по-голямата част от мощността на процесора се контролира от честни възли, честната верига ще расте най-бързо и ще изпревари всички конкурентни вериги. За да модифицира минал блок, атакуващият ще трябва да преработи доказателството за работа на блока и всички блокове след него, а след това да настигне и надмине работата на честните възли. По-късно ще покажем, че вероятността по-бавен атакуващ да настигне намалява експоненциално с добавянето на следващи блокове.

За да се компенсира нарастващата скорост на хардуера и променливият интерес към изпълнението на възли с течение на времето, трудността на доказателството за работа се определя от пълзяща средна, насочена към среден брой блокове на час. Ако те се генерират твърде бързо, трудността се увеличава.

\end{document}